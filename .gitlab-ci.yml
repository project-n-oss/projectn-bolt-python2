stages:
  - package

verify:
  image: python:2.7.16-alpine3.8
  stage: package
  rules:
    - if: '$CI_COMMIT_BRANCH != "master"'
  script:
    - python --version
    - python -m pip install twine setuptools wheel
    - python setup.py sdist bdist_wheel
    - twine check dist/*

package:
  image: python:2.7.16-alpine3.8
  stage: package
  rules:
    - if: '$CI_COMMIT_BRANCH == "master"'
  script:
    - python -m pip install twine setuptools wheel
    - python setup.py sdist bdist_wheel
    - twine check dist/*
    - echo -e "[distutils]\nindex-servers = pypi\n\n[pypi]\nusername = __token__\npassword = ${PYPI_API_TOKEN}\n" >> ~/.pypirc
    - twine upload --verbose dist/*